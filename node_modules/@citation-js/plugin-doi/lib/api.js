"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseAsync = exports.parse = void 0;

var _json = _interopRequireDefault(require("./json"));

var _core = require("@citation-js/core");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const apiOptions = {
  checkContentType: true,
  headers: {
    Accept: 'application/vnd.citationstyles.csl+json'
  }
};

const fetchDoiApiAsync = async function (url) {
  const result = await _core.util.fetchFileAsync(url, apiOptions);
  return result === '[]' ? {} : JSON.parse(result);
};

const parseDoiApiAsync = async function (data) {
  const doiJsonList = await Promise.all([].concat(data).map(fetchDoiApiAsync));
  return doiJsonList.map(_json.default);
};

exports.parseAsync = parseDoiApiAsync;

const fetchDoiApi = function (url) {
  const result = _core.util.fetchFile(url, apiOptions);

  return result === '[]' ? {} : JSON.parse(result);
};

const parseDoiApi = data => [].concat(data).map(fetchDoiApi).map(_json.default);

exports.parse = parseDoiApi;